<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CalvoGames</title>
    
    <meta name="description" content="CalvoGames es una web de juegos indie y proyectos en desarrollo con descargas directas y próximos lanzamientos.">
    <link rel="icon" href="./favicon.ico" type="image/x-icon">

    <meta property="og:title" content="CalvoGames">
    <meta property="og:description" content="Juegos indie en desarrollo con descarga directa y próximos lanzamientos.">
    <meta property="og:image" content="/preview.png">
    <meta property="og:url" content="https://calvogames.pages.dev">
    <meta property="og:type" content="website">

    <style>
        body { font-family: sans-serif; background-color: #1a1a1a; color: white; margin: 0; }
        #cg-auth-container { display: flex; align-items: center; padding: 15px; background: #252525; border-bottom: 1px solid #333; }
        #user-avatar { width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; margin-right: 12px; }
        .btn-owner-cg { background: #4caf50; color: white; padding: 8px 12px; border-radius: 4px; font-weight: bold; border: none; margin-left: 15px; cursor: pointer; }
        .btn-admin-cg { background: #f44336; color: white; padding: 8px 12px; border-radius: 4px; font-weight: bold; border: none; margin-left: 15px; cursor: pointer; }
        .btn-sesion-cg { cursor: pointer; color: #aaa; text-decoration: underline; font-size: 0.9em; }
    </style>
</head>
<body>

    <div id="cg-auth-container">
        <div id="user-avatar">?</div>
        <div>
            <span id="cg-user-name">Cargando...</span>
            <div id="session-action"></div>
        </div>
        <button id="panel-btn" style="display: none;"></button>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>

    <script>
        // 1. Configuración de Seguridad
        const OWNER_EMAIL = "calvoonyt@gmail.com"; 

        // 2. CONFIGURACIÓN FIREBASE (RELLENA ESTO)
        const firebaseConfig = {
            apiKey: "TU_API_KEY_AQUI",
            authDomain: "TU_DOMINIO.firebaseapp.com",
            projectId: "TU_PROJECT_ID",
            storageBucket: "TU_BUCKET.appspot.com",
            messagingSenderId: "TU_SENDER_ID",
            appId: "TU_APP_ID"
        };

        // Inicialización
        firebase.initializeApp(firebaseConfig);
        const cgAuth = firebase.auth();
        const cgDb = firebase.firestore();

        // 3. Lógica de Sesión y Roles
        cgAuth.onAuthStateChanged((user) => {
            const nombre = document.getElementById('cg-user-name');
            const letra = document.getElementById('user-avatar');
            const container = document.getElementById('session-action');
            const panelBtn = document.getElementById('panel-btn');

            if (user) {
                // Usuario Logueado
                nombre.innerText = user.displayName || "Usuario";
                letra.innerText = (user.displayName || "U").charAt(0).toUpperCase();
                letra.style.background = "#ff9800";
                container.innerHTML = '<span class="btn-sesion-cg" id="cg-logout">Cerrar Sesión</span>';
                
                document.getElementById('cg-logout').onclick = () => {
                    cgAuth.signOut().then(() => location.reload());
                };

                // Comprobar si es el Dueño
                if (user.email === OWNER_EMAIL) {
                    panelBtn.style.display = "block";
                    panelBtn.className = "btn-owner-cg"; 
                    panelBtn.innerText = "⭐ OWNER PANEL";
                } else {
                    // Comprobar si es Admin en Firestore
                    cgDb.collection("users").doc(user.uid).get().then((doc) => {
                        if (doc.exists && doc.data().rol === "admin") {
                            panelBtn.style.display = "block";
                            panelBtn.className = "btn-admin-cg";
                            panelBtn.innerText = "⚙️ ADMIN PANEL";
                        }
                    }).catch(err => console.error("Error validando rol:", err));
                }
            } else {
                // Usuario Invitado
                letra.innerText = "?";
                letra.style.background = "#555";
                nombre.innerText = "Invitado";
                panelBtn.style.display = "none";
                container.innerHTML = '<a href="login/" style="color:#aaa; text-decoration:none;">Iniciar Sesión</a>';
            }
        });
    </script>
</body>
</html>